{% extends "base.html" %}
{% block content %}
<div class="index-container">
  <div class="system-hero">
    <h1>Ledger Analysis System</h1>
    <div class="academic-year-badge">Academic Year: 2025-2026</div>
  </div>

  <div class="forms-wrapper">
    <div class="glass-form-card">
      <h2>ðŸ“¤ Upload New Ledger</h2>
      <form action="{{ url_for('analyze') }}" method="post" enctype="multipart/form-data">
        <div class="form-group">
          <label>Select Year (To determine Parser):</label>
          <select name="class_year" required>
            <option value="fy">First Year (NEP Parser)</option>
            <option value="sy">Second Year (SY Parser)</option>
            <option value="ty">Third Year (2019 Parser)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Upload Ledger PDF:</label>
          <input type="file" name="ledger_pdf" accept=".pdf" required />
        </div>
        <button type="submit" class="btn-primary" style="margin-top: 20px;">Process and Analyze</button>
      </form>
    </div>

    <div class="glass-form-card">
      <h2>ðŸ“œ View Saved Reports</h2>
      <form action="{{ url_for('view_saved') }}" method="get">
        
        <div class="form-group">
          <label>Select Department:</label>
          <select id="course_select" name="course" required onchange="updateYearDropdown()">
            <option value="">-- Select Department --</option>
            {% set unique_courses = [] %}
            {% for record in saved_options %}
              {% if record.course not in unique_courses %}
                <option value="{{ record.course }}">{{ record.course }}</option>
                {% set _ = unique_courses.append(record.course) %}
              {% endif %}
            {% endfor %}
          </select>
        </div>

        <div class="form-group" style="margin-top: 15px;">
          <label>Select Academic Year:</label>
          <select id="year_select" name="year" required disabled>
            <option value="">-- First Select Department --</option>
          </select>
        </div>

        <button type="submit" class="btn-secondary" style="margin-top: 20px;">View History Data</button>
      </form>
    </div>
  </div>
</div>

<div id="data-holder" data-saved='{{ saved_options | tojson | safe }}' style="display: none;"></div>

<script>
    const dataElement = document.getElementById('data-holder');
    const savedData = JSON.parse(dataElement.getAttribute('data-saved'));
</script>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}